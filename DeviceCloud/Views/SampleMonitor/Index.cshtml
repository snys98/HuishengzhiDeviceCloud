@using System.Configuration
@using DeviceCloud.Models
@using DeviceLibrary
@using Newtonsoft.Json


<div class="am-g am-g-fixed transmonitor-g-fixed">
	<div class="am-u-md-4">
		<div class="am-panel-group">
			<section class="am-panel am-panel-primary">
				<div class="am-panel-hd">样本转运监控</div>
				<div class="am-panel-bd">
					
				</div>
			</section>
			<section class="am-panel am-panel-primary">
				<div class="am-panel-hd">详情</div>
				<div class="am-panel-bd">

				</div>
			</section>
			<section class="am-panel am-panel-primary">
				<div class="am-panel-hd">选项</div>
				<div class="am-panel-bd">

				</div>
			</section>
		</div>
	</div>
	<div class="am-u-md-8" style="height: 100%;">
		<div class="am-panel-group">
			<section class="am-panel am-panel-primary">
				<div class="am-panel-hd">地图视图</div>
				<div id="Bmap" class="am-panel-bd"></div>
			</section>
			<section class="am-panel am-panel-primary">
				<div class="am-panel-hd">数据视图</div>
				<div id="chart" class="am-panel-bd"></div>
			</section>
		</div>
	</div>
</div>
@section CustomScripts
{
	@*引入百度地图*@
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=@ConfigurationManager.AppSettings.Get("BaiduApiKey")"></script>
	<script type="text/javascript" src="~/Content/js/map/map-api.js"></script>
	@*引入echart*@
	<script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
	<script type="text/javascript">
		// 百度地图API功能
		var map = new BMap.Map("Bmap"); // 创建Map实例
		var chart;
		var chartOption;
		//初始化echart
		require.config({
			paths: {
				echarts: 'http://echarts.baidu.com/build/dist'
			}
		});

		// 使用
		require(
			[
				'echarts',
				'echarts/chart/line' // 使用柱状图就加载bar模块，按需加载
			],
			function(ec) {
				// 基于准备好的dom，初始化echarts图表
				chart = ec.init(document.getElementById('chart'));
				chartOption = {
					tooltip: {
						show: true
					},
					legend: {
						data: ['温度(℃)', '湿度(%)']
					},
					xAxis: [
						{
							type: 'category',
							//这里赋值X坐标轴上的值,应该赋值时间
							data: ["2015-12-1", "2015-12-2", "2015-12-3", "2015-12-4", "2015-12-5", "2015-12-6"]
						}
					],
					yAxis: [
						{
							type: 'value'
						}
					],
					series: [
						{
							"name": "温度(℃)",
							"type": "line",
							//这里赋值Y坐标轴上的值,应该赋值对应时间的值
							"data": [50, 20, 10, 30, 45, 26]
						},
						{
							"name": "湿度(%)",
							"type": "line",
							//这里赋值Y坐标轴上的值,应该赋值对应时间的值
							"data": [25, 30, 41, 8, 19, 25]
						}
					]
				}
				chart.setOption(chartOption);
			}
		);


		$(document).ready(function() {
			map.centerAndZoom(new BMap.Point(104.072168, 30.557979), 17); // 初始化地图,设置中心点坐标和地图级别
			map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
		}());

		//建立marker内容
		function buildMarkerContent(infoList) {
			var html = "<div>";
			html += "<p>温度: " + infoList.Temperature + " ℃<p>";
			html += "<p>湿度: " + infoList.Humidity + " %<p>";
			html += "</div>";
			return html;
		}

		//初始化所有点位置,时间格式:yyyyMMddHHmmss
		function loadMarkers(transLogs) {
			for (var i = 0; i < transLogs.length; i++) {
				AddWindowMarker(transLogs[i].Longitude, transLogs[i].Latitude, buildMarkerContent(transLogs[i]));
			}
			@*var content;
		@foreach (TranLog data in ViewBag.Monitor.Datas)
			{
			<text>
		content = "@Html.Raw(data.ToMarkerInfo())"
		AddWindowMarker(@data.Longitude, @data.Latitude, content);
		</text>
			}*@
		};

		function loadChart(transLogs) {
			//Todo:根据transLogs构造数据
		};

		function reloadDatas(parameters) {
			$.post("@Url.Action("GetSampleMonitor", "SampleMonitor")",
				{
					startTime: "20151216000000",
					endTime: "20151218000000",
					deviceId: "051201001"
				},
				function (data, status) {
					if (status == "success") {
						loadMarkers(data.TransLogs);
						loadChart(data.TransLogs);
					}
				},"json");
		}
	</script>
}
@section CustomStyle
{
	<style type="text/css">
		@@media only screen and (min-width: 1200px) {
			.transmonitor-g-fixed {
				max-width: 1200px;
			}
		}

		@@media only screen and (min-width: 641px) {
			.transmonitor-sidebar {
				font-size: 1.4rem;
				padding-top: 20px;
			}
		}

		#Bmap {
				width: 100%;
				height: 38vh;
			}
		#chart {
			width: 100%;
			height: 38vh;
		}

		.transmonitor-g-fixed {
				padding-top: 10px;
			}

		body {
			height: 100vh;
		}

		footer {
			bottom: 0;
			position: fixed;
			width: 100vw;
		}
	</style>
}